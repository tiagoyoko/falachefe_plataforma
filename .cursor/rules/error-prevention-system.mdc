---
alwaysApply: true
---
# Sistema de Preven√ß√£o de Erros - FalaChefe

## üéØ Regra de Ouro

**SEMPRE diagnostique ANTES de mudar c√≥digo. NUNCA assuma onde est√° o problema.**

## üìã Checklist Obrigat√≥rio Antes de Qualquer Mudan√ßa

### 1. Diagn√≥stico PRIMEIRO

```bash
# Execute isto ANTES de mudar qualquer c√≥digo
./scripts/diagnose-production.sh
```

**N√£o pule este passo!** O script verifica:
- DNS (Vercel + API)
- SSL/HTTPS
- Endpoints ativos
- Processamento real

### 2. Identificar Camada do Problema

| Camada | Se falhar | A√ß√£o |
|--------|-----------|------|
| **DNS** | `dig api.falachefe.app.br` retorna vazio | Configurar DNS, **N√ÉO mexer em c√≥digo** |
| **SSL** | Certificado inv√°lido/expirado | Verificar Traefik/Let's Encrypt |
| **Network** | `curl https://api...` timeout | Verificar servidor Hetzner (SSH) |
| **Application** | Endpoint retorna erro | Ver logs Docker/Vercel |
| **Code** | Logs mostram erro de l√≥gica | **S√ì AQUI** mexer em c√≥digo |

### 3. Logs Detalhados

**SEMPRE** adicione logs em:
- ‚úÖ In√≠cio de opera√ß√£o
- ‚úÖ Dados recebidos/enviados
- ‚úÖ Resultado da opera√ß√£o
- ‚úÖ Erros (com contexto)

**Formato preferido**:
```typescript
console.log('üîµ [A√ß√£o]:', { dados, contexto });
console.log('‚úÖ [Sucesso]:', { resultado, tempo });
console.log('‚ùå [Erro]:', { erro, contexto });
```

### 4. Valida√ß√£o Pr√©-Deploy

```bash
# Execute SEMPRE antes de commit/deploy:
npm run lint
npm run build
./scripts/diagnose-production.sh  # Validar que produ√ß√£o est√° OK
```

## ‚ö†Ô∏è Sinais de Alerta

**N√ÉO fa√ßa mudan√ßas se**:
- ‚ùå N√£o executou diagn√≥stico
- ‚ùå N√£o sabe qual camada tem problema
- ‚ùå Est√° "tentando algo para ver se funciona"
- ‚ùå Mudou mesma coisa 2+ vezes sem sucesso

**Pare e investigue mais!**

## üìö Recursos

Quando algo der errado:
1. Execute [diagnose-production.sh](mdc:scripts/diagnose-production.sh)
2. Leia [LESSONS-LEARNED.md](mdc:docs/quality/LESSONS-LEARNED.md)
3. Crie Post-Mortem se erro persistir

## üîÑ Ciclo Correto

```
Erro ‚Üí Diagn√≥stico ‚Üí Identificar Camada ‚Üí Planejar Fix ‚Üí Implementar ‚Üí Validar ‚Üí Documentar
```

**NUNCA**:
```
Erro ‚Üí Mudar C√≥digo ‚Üí Testar ‚Üí Repetir
```
